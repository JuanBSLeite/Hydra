<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Hydra: splot.inl</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Hydra
   &#160;<span id="projectnumber">2.2.1</span>
   </div>
   <div id="projectbrief">A header-only templated C++ framework to perform data analysis on massively parallel platforms.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('splot_8inl-example.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">splot.inl</div>  </div>
</div><!--header-->
<div class="contents">
<p>This example shows how to perform S-plots using Hydra.A 2-dimensional dataset is generated. The first column is distributed as a Gaussian signal on top of an Exponential background. The signal distribution is associated to an exponentialy distributed control variable in the second colunm andd the background to the sum of two Gaussians.</p>
<div class="fragment"><div class="line"><span class="comment">/*----------------------------------------------------------------------------</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *   Copyright (C) 2016 - 2018 Antonio Augusto Alves Junior</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *   This file is part of Hydra Data Analysis Framework.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *   Hydra is free software: you can redistribute it and/or modify</span></div><div class="line"><span class="comment"> *   it under the terms of the GNU General Public License as published by</span></div><div class="line"><span class="comment"> *   the Free Software Foundation, either version 3 of the License, or</span></div><div class="line"><span class="comment"> *   (at your option) any later version.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *   Hydra is distributed in the hope that it will be useful,</span></div><div class="line"><span class="comment"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><span class="comment"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><span class="comment"> *   GNU General Public License for more details.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *   You should have received a copy of the GNU General Public License</span></div><div class="line"><span class="comment"> *   along with Hydra.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *---------------------------------------------------------------------------*/</span></div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * splot.inl</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *  Created on: 17/09/2017</span></div><div class="line"><span class="comment"> *      Author: Antonio Augusto Alves Junior</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#ifndef SPLOT_INL_</span></div><div class="line"><span class="preprocessor">#define SPLOT_INL_</span></div><div class="line"></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * \example splot.inl</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This example shows how to perform S-plots using Hydra.</span></div><div class="line"><span class="comment"> * A 2-dimensional dataset is generated. The first column</span></div><div class="line"><span class="comment"> * is distributed as a Gaussian signal on top of an Exponential background.</span></div><div class="line"><span class="comment"> * The signal distribution is associated to an exponentialy distributed control variable</span></div><div class="line"><span class="comment"> * in the second colunm andd the background to the sum of two Gaussians.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;chrono&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;random&gt;</span></div><div class="line"></div><div class="line"><span class="comment">//command line</span></div><div class="line"><span class="preprocessor">#include &lt;tclap/CmdLine.h&gt;</span></div><div class="line"></div><div class="line"><span class="comment">//this lib</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="device_2System_8h.html">hydra/device/System.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="host_2System_8h.html">hydra/host/System.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Function_8h.html">hydra/Function.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="FunctionWrapper_8h.html">hydra/FunctionWrapper.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Random_8h.html">hydra/Random.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="LogLikelihoodFCN_8h.html">hydra/LogLikelihoodFCN.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Parameter_8h.html">hydra/Parameter.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="UserParameters_8h.html">hydra/UserParameters.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Pdf_8h.html">hydra/Pdf.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="AddPdf_8h.html">hydra/AddPdf.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Algorithm_8h.html">hydra/Algorithm.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Filter_8h.html">hydra/Filter.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="GaussKronrodQuadrature_8h.html">hydra/GaussKronrodQuadrature.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="SPlot_8h.html">hydra/SPlot.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="DenseHistogram_8h.html">hydra/DenseHistogram.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="SparseHistogram_8h.html">hydra/SparseHistogram.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Gaussian_8h.html">hydra/functions/Gaussian.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Exponential_8h.html">hydra/functions/Exponential.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">//Minuit2</span></div><div class="line"><span class="preprocessor">#include &quot;Minuit2/FunctionMinimum.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;Minuit2/MnUserParameterState.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;Minuit2/MnPrint.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;Minuit2/MnMigrad.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;Minuit2/MnMinimize.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;Minuit2/MnMinos.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;Minuit2/MnContours.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;Minuit2/CombinedMinimizer.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;Minuit2/MnPlot.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;Minuit2/MinosError.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;Minuit2/ContoursError.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;Minuit2/VariableMetricMinimizer.h&quot;</span></div><div class="line"></div><div class="line"><span class="comment">/*-------------------------------------</span></div><div class="line"><span class="comment"> * Include classes from ROOT to fill</span></div><div class="line"><span class="comment"> * and draw histograms and plots.</span></div><div class="line"><span class="comment"> *-------------------------------------</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="preprocessor">#ifdef _ROOT_AVAILABLE_</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;TROOT.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;TH1D.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;TApplication.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;TCanvas.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#endif //_ROOT_AVAILABLE_</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceROOT_1_1Minuit2.html">ROOT::Minuit2</a>;</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a name="a0"></a><a class="code" href="splot_8inl.html#a1c03069360f1f90a556eb537e0ff8a72">main</a>(<span class="keywordtype">int</span> argv, <span class="keywordtype">char</span>** argc)</div><div class="line">{</div><div class="line">    <span class="keywordtype">size_t</span> nentries = 0;</div><div class="line"></div><div class="line">    <span class="keywordflow">try</span> {</div><div class="line"></div><div class="line">        TCLAP::CmdLine cmd(<span class="stringliteral">&quot;Command line arguments for &quot;</span>, <span class="charliteral">&#39;=&#39;</span>);</div><div class="line"></div><div class="line">        TCLAP::ValueArg&lt;size_t&gt; EArg(<span class="stringliteral">&quot;n&quot;</span>, <span class="stringliteral">&quot;number-of-events&quot;</span>,<span class="stringliteral">&quot;Number of events&quot;</span>, <span class="keyword">true</span>, 10e6, <span class="stringliteral">&quot;size_t&quot;</span>);</div><div class="line">        cmd.add(EArg);</div><div class="line"></div><div class="line">        <span class="comment">// Parse the argv array.</span></div><div class="line">        cmd.parse(argv, argc);</div><div class="line"></div><div class="line">        <span class="comment">// Get the value parsed by each arg.</span></div><div class="line">        nentries = EArg.getValue();</div><div class="line"></div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span> (TCLAP::ArgException &amp;e)  {</div><div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;error: &quot;</span> &lt;&lt; e.error() &lt;&lt; <span class="stringliteral">&quot; for arg &quot;</span> &lt;&lt; e.argId()</div><div class="line">                                                        &lt;&lt; std::endl;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">//-----------------</span></div><div class="line">    <span class="comment">// some definitions</span></div><div class="line">    <span class="keywordtype">double</span> min   =  0.0;</div><div class="line">    <span class="keywordtype">double</span> <a name="a1"></a><a class="code" href="namespacehydra_1_1detail.html#a1152192bafa3c9d955919ee2fa88f8ef">max</a>   =  10.0;</div><div class="line"></div><div class="line">    <span class="comment">//generator</span></div><div class="line">    <a name="_a2"></a><a class="code" href="group__random.html#classhydra_1_1Random">hydra::Random&lt;&gt;</a> Generator( std::chrono::system_clock::now().time_since_epoch().count() );</div><div class="line"></div><div class="line">    <span class="comment">//----------------------</span></div><div class="line">    <span class="comment">//fit model</span></div><div class="line">    <span class="comment">// gaussian</span></div><div class="line">    <span class="comment">// mean of gaussian</span></div><div class="line">    <a name="_a3"></a><a class="code" href="group__fit.html#structhydra_1_1Parameter">hydra::Parameter</a>  mean_p  = <a name="a4"></a><a class="code" href="group__fit.html#ab71317b03a67ac0de6daec09c16df4c6">hydra::Parameter::Create</a>().<a name="a5"></a><a class="code" href="group__fit.html#abd604574084c4877e12eb4a429d3a5bf">Name</a>(<span class="stringliteral">&quot;Mean&quot;</span>).<a name="a6"></a><a class="code" href="group__fit.html#ab9d71d53dc79d1839971ec8cdced636a">Value</a>( 2.5) .<a name="a7"></a><a class="code" href="group__fit.html#a49f5d6946e744c41d88678858386c0b1">Error</a>(0.0001).<a name="a8"></a><a class="code" href="group__fit.html#affd113cf96daed021e40e90ecd44286e">Limits</a>(0.0, 10.0);</div><div class="line">    <span class="comment">// sigma of gaussian</span></div><div class="line">    <a class="code" href="group__fit.html#structhydra_1_1Parameter">hydra::Parameter</a>  sigma_p = <a class="code" href="group__fit.html#ab71317b03a67ac0de6daec09c16df4c6">hydra::Parameter::Create</a>().<a class="code" href="group__fit.html#abd604574084c4877e12eb4a429d3a5bf">Name</a>(<span class="stringliteral">&quot;Sigma&quot;</span>).<a class="code" href="group__fit.html#ab9d71d53dc79d1839971ec8cdced636a">Value</a>(0.5).<a class="code" href="group__fit.html#a49f5d6946e744c41d88678858386c0b1">Error</a>(0.0001).<a class="code" href="group__fit.html#affd113cf96daed021e40e90ecd44286e">Limits</a>(0.01, 1.5);</div><div class="line"></div><div class="line">    <span class="keyword">auto</span> gaussian = <a name="_a9"></a><a class="code" href="group__common__functions.html#classhydra_1_1Gaussian">hydra::Gaussian&lt;0&gt;</a>(mean_p, sigma_p);</div><div class="line"></div><div class="line">    <span class="comment">//--------------------------------------------</span></div><div class="line">    <span class="comment">//exponential</span></div><div class="line">    <span class="comment">//parameters</span></div><div class="line">    <span class="comment">// tau of the exponential</span></div><div class="line">    <a class="code" href="group__fit.html#structhydra_1_1Parameter">hydra::Parameter</a>  tau_p  = <a class="code" href="group__fit.html#ab71317b03a67ac0de6daec09c16df4c6">hydra::Parameter::Create</a>().<a class="code" href="group__fit.html#abd604574084c4877e12eb4a429d3a5bf">Name</a>(<span class="stringliteral">&quot;Tau&quot;</span>).<a class="code" href="group__fit.html#ab9d71d53dc79d1839971ec8cdced636a">Value</a>(0.0) .<a class="code" href="group__fit.html#a49f5d6946e744c41d88678858386c0b1">Error</a>(0.0001).<a class="code" href="group__fit.html#affd113cf96daed021e40e90ecd44286e">Limits</a>(-10.0, 10.0);</div><div class="line"></div><div class="line">    <span class="keyword">auto</span> exponential =  <a name="_a10"></a><a class="code" href="group__common__functions.html#classhydra_1_1Exponential">hydra::Exponential&lt;0&gt;</a>(tau_p);</div><div class="line"></div><div class="line">    <span class="comment">//------------------</span></div><div class="line">    <span class="comment">//yields</span></div><div class="line">    <a class="code" href="group__fit.html#structhydra_1_1Parameter">hydra::Parameter</a> N_Gauss_p(<span class="stringliteral">&quot;N_Gauss&quot;</span> ,nentries, <a name="a11"></a><a class="code" href="namespacehydra.html#a74988a829019bf111e7f51d81b33eec7">sqrt</a>(nentries), nentries-nentries/2 , nentries+nentries/2) ;</div><div class="line">    <a class="code" href="group__fit.html#structhydra_1_1Parameter">hydra::Parameter</a> N_Exp_p( <span class="stringliteral">&quot;N_Exp&quot;</span>,nentries, <a class="code" href="namespacehydra.html#a74988a829019bf111e7f51d81b33eec7">sqrt</a>(nentries), nentries-nentries/2 , nentries+nentries/2) ;</div><div class="line"></div><div class="line">    std::array&lt;hydra::Parameter, 2&gt;  yields{ N_Gauss_p, N_Exp_p };</div><div class="line"></div><div class="line">    <span class="comment">//device</span></div><div class="line">    <span class="comment">//------------------------</span></div><div class="line"><span class="preprocessor">#ifdef _ROOT_AVAILABLE_</span></div><div class="line"></div><div class="line">    TH1D hist_data_dicriminating_d(<span class="stringliteral">&quot;data_discriminating_d&quot;</span>, <span class="stringliteral">&quot;Discriminating variable&quot;</span>, 100, min, <a class="code" href="namespacehydra_1_1detail.html#a1152192bafa3c9d955919ee2fa88f8ef">max</a>);</div><div class="line">    TH1D hist_data_control_d(<span class="stringliteral">&quot;data_control_d&quot;</span>, <span class="stringliteral">&quot;Control Variable&quot;</span>, 100, min, <a class="code" href="namespacehydra_1_1detail.html#a1152192bafa3c9d955919ee2fa88f8ef">max</a>);</div><div class="line">    TH1D hist_fit_d(<span class="stringliteral">&quot;fit_d&quot;</span>, <span class="stringliteral">&quot;Discriminating variable&quot;</span>, 100, min, <a class="code" href="namespacehydra_1_1detail.html#a1152192bafa3c9d955919ee2fa88f8ef">max</a>);</div><div class="line">    TH1D hist_control_1_d(<span class="stringliteral">&quot;control_1_d&quot;</span>, <span class="stringliteral">&quot;Control Variable: Gaussian PDF&quot;</span>,    100, min, <a class="code" href="namespacehydra_1_1detail.html#a1152192bafa3c9d955919ee2fa88f8ef">max</a>);</div><div class="line">    TH1D hist_control_2_d(<span class="stringliteral">&quot;control_2_d&quot;</span>, <span class="stringliteral">&quot;Control Variable: Exponential PDF&quot;</span>,    100, min, <a class="code" href="namespacehydra_1_1detail.html#a1152192bafa3c9d955919ee2fa88f8ef">max</a>);</div><div class="line"><span class="preprocessor">#endif //_ROOT_AVAILABLE_</span></div><div class="line"></div><div class="line">    {</div><div class="line"></div><div class="line">        <span class="comment">//------------------</span></div><div class="line">        <span class="comment">//make model</span></div><div class="line">        <span class="comment">//numerical integral to normalize the pdfs</span></div><div class="line">        <a name="_a12"></a><a class="code" href="namespacehydra.html#classhydra_1_1GaussKronrodQuadrature">hydra::GaussKronrodQuadrature&lt;61,50, hydra::device::sys_t&gt;</a> GKQ61_d(min,  <a class="code" href="namespacehydra_1_1detail.html#a1152192bafa3c9d955919ee2fa88f8ef">max</a>);</div><div class="line"></div><div class="line">        <span class="comment">//convert functors to pdfs</span></div><div class="line">        <span class="keyword">auto</span> Gauss_PDF = <a name="a13"></a><a class="code" href="group__fit.html#ga2d468a0d98a74f41479f8ccb95f5533e">hydra::make_pdf</a>(gaussian  , GKQ61_d);</div><div class="line">        <span class="keyword">auto</span>    Exp_PDF = <a class="code" href="group__fit.html#ga2d468a0d98a74f41479f8ccb95f5533e">hydra::make_pdf</a>(exponential, GKQ61_d);</div><div class="line"></div><div class="line">        <span class="keyword">auto</span> model = <a name="a14"></a><a class="code" href="group__fit.html#ga7e7cc3bb04eac1d1350bb41b254fc92b">hydra::add_pdfs</a>({ N_Gauss_p, N_Exp_p }, Gauss_PDF, Exp_PDF);</div><div class="line"></div><div class="line">        model.SetExtended(1);</div><div class="line"></div><div class="line">        <span class="comment">//1D data containers</span></div><div class="line">        <a name="_a15"></a><a class="code" href="namespacehydra.html#classhydra_1_1multiarray">hydra::multiarray&lt;double,2,  hydra::device::sys_t&gt;</a> data_d(2*nentries);</div><div class="line">        <a class="code" href="namespacehydra.html#classhydra_1_1multiarray">hydra::multiarray&lt;double,2,  hydra::host::sys_t&gt;</a>   data_h(2*nentries);</div><div class="line"></div><div class="line">        <span class="comment">//-------------------------------------------------------</span></div><div class="line">        <span class="comment">// Generate toy data</span></div><div class="line"></div><div class="line">        <span class="comment">//first component: [Gaussian] x [Exponential]</span></div><div class="line">        <span class="comment">// gaussian</span></div><div class="line">        Generator.<a name="a16"></a><a class="code" href="group__random.html#afde3701ccc69442bc6b9c68a66dc32d6">Gauss</a>(mean_p.GetValue()+2.5, sigma_p.<a name="a17"></a><a class="code" href="group__fit.html#af57133d586edceb8319499dbd6ad2099">GetValue</a>()+0.5, data_d.begin(0), data_d.begin(0)+nentries);</div><div class="line"></div><div class="line">        <span class="comment">// exponential</span></div><div class="line"></div><div class="line">        Generator.<a name="a18"></a><a class="code" href="group__random.html#ad13cdb1fc8076997e9cd989641529419">Exp</a>(tau_p.GetValue()+1.0, data_d.begin(1),  data_d.begin(1)+nentries);</div><div class="line"></div><div class="line">        <span class="comment">//second component: [Exponential] -&gt; [Gaussian]</span></div><div class="line">        <span class="comment">// gaussian</span></div><div class="line">        Generator.<a class="code" href="group__random.html#afde3701ccc69442bc6b9c68a66dc32d6">Gauss</a>(mean_p.GetValue()-1.0, 0.5, data_d.begin(1) + nentries, data_d.begin(1) + nentries + nentries/2);</div><div class="line">        Generator.<a class="code" href="group__random.html#afde3701ccc69442bc6b9c68a66dc32d6">Gauss</a>(mean_p.GetValue()+4.5, 0.5, data_d.begin(1) + nentries + nentries/2, data_d.end(1));</div><div class="line"></div><div class="line">        <span class="comment">// exponential</span></div><div class="line">        Generator.<a class="code" href="group__random.html#ad13cdb1fc8076997e9cd989641529419">Exp</a>(tau_p.GetValue()+5.0, data_d.begin(0)+nentries,  data_d.end(0));</div><div class="line"></div><div class="line">        std::cout&lt;&lt; std::endl&lt;&lt; <span class="stringliteral">&quot;Generated data:&quot;</span>&lt;&lt; std::endl;</div><div class="line">        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;10; i++)</div><div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;] :&quot;</span> &lt;&lt; data_d[i] &lt;&lt; std::endl;</div><div class="line"></div><div class="line">        <span class="comment">//-------------------------------------------------------</span></div><div class="line">        <span class="comment">// Bring data to host and suffle it to avoid biases</span></div><div class="line"></div><div class="line">        <a name="a19"></a><a class="code" href="namespacehydra.html#a0b928198a46f83eb9d2793e8e079ba5a">hydra::copy</a>(data_d,   data_h);</div><div class="line"></div><div class="line">        std::random_device rd;</div><div class="line">        std::mt19937 g(rd());</div><div class="line">        std::shuffle(data_h.begin(), data_h.end(), g);</div><div class="line"></div><div class="line">        <a class="code" href="namespacehydra.html#a0b928198a46f83eb9d2793e8e079ba5a">hydra::copy</a>(data_h, data_d);</div><div class="line"></div><div class="line">        std::cout&lt;&lt; std::endl&lt;&lt; <span class="stringliteral">&quot;Suffled data:&quot;</span>&lt;&lt; std::endl;</div><div class="line">        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;10; i++)</div><div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;] :&quot;</span> &lt;&lt; data_d[i] &lt;&lt; std::endl;</div><div class="line"></div><div class="line">        <span class="comment">//filtering</span></div><div class="line">        <span class="keyword">auto</span> FILTER = [=] __hydra_dual__ (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n, <span class="keywordtype">double</span>* x){</div><div class="line">            <span class="keywordflow">return</span> (x[0] &gt; min) &amp;&amp; (x[0] &lt; <a class="code" href="namespacehydra_1_1detail.html#a1152192bafa3c9d955919ee2fa88f8ef">max</a> );</div><div class="line">        };</div><div class="line"></div><div class="line">        <span class="keyword">auto</span> filter = <a name="a20"></a><a class="code" href="group__functor.html#ga1ed4b0fb2957a3933162b9fc3f386203">hydra::wrap_lambda</a>(FILTER);</div><div class="line">        <span class="keyword">auto</span> <a name="a21"></a><a class="code" href="namespacehydra.html#a0cd814fb01cd9d4d7ca9fa8c289627d9">range</a>  = <a name="a22"></a><a class="code" href="namespacehydra.html#a74342b65e8d5baef11d2518da6fae223">hydra::apply_filter</a>(data_d,  filter);</div><div class="line"></div><div class="line">        std::cout&lt;&lt; std::endl&lt;&lt; <span class="stringliteral">&quot;Filtered data:&quot;</span>&lt;&lt; std::endl;</div><div class="line">        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;10; i++)</div><div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;] :&quot;</span> &lt;&lt; <a class="code" href="namespacehydra.html#a0cd814fb01cd9d4d7ca9fa8c289627d9">range</a>.begin()[i] &lt;&lt; std::endl;</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">//make model and fcn</span></div><div class="line">        <span class="keyword">auto</span> fcn   = <a name="a23"></a><a class="code" href="group__fit.html#ga7e8371bd525078a66b90577586cd712c">hydra::make_loglikehood_fcn</a>(model, <a class="code" href="namespacehydra.html#a0cd814fb01cd9d4d7ca9fa8c289627d9">range</a>.begin(), <a class="code" href="namespacehydra.html#a0cd814fb01cd9d4d7ca9fa8c289627d9">range</a>.end() );</div><div class="line"></div><div class="line">        <span class="comment">//-------------------------------------------------------</span></div><div class="line">        <span class="comment">//fit</span></div><div class="line">        ROOT::Minuit2::MnPrint::SetLevel(3);</div><div class="line">        <a name="a24"></a><a class="code" href="classhydra_1_1Print.html#a03a2522e2192b2509284f25b4b899c7c">hydra::Print::SetLevel</a>(<a name="a25"></a><a class="code" href="namespacehydra.html#aed873b1b84fbec3791e721b22a52d1fea1bf857a06d5b8463494a6fcac6f4ea26">hydra::WARNING</a>);</div><div class="line">        <span class="comment">//minimization strategy</span></div><div class="line">        MnStrategy strategy(2);</div><div class="line"></div><div class="line">        <span class="comment">// create Migrad minimizer</span></div><div class="line">        MnMigrad migrad_d(fcn, fcn.GetParameters().GetMnState() ,  strategy);</div><div class="line"></div><div class="line">        std::cout&lt;&lt;fcn.GetParameters().GetMnState()&lt;&lt;std::endl;</div><div class="line"></div><div class="line">        <span class="comment">// ... Minimize and profile the time</span></div><div class="line"></div><div class="line">        <span class="keyword">auto</span> start_d = std::chrono::high_resolution_clock::now();</div><div class="line">        FunctionMinimum minimum_d =  FunctionMinimum(migrad_d(<a class="code" href="namespacehydra_1_1detail.html#a1152192bafa3c9d955919ee2fa88f8ef">std::numeric_limits&lt;unsigned int&gt;::max</a>(), 5));</div><div class="line">        <span class="keyword">auto</span> end_d = std::chrono::high_resolution_clock::now();</div><div class="line">        std::chrono::duration&lt;double, std::milli&gt; elapsed_d = end_d - start_d;</div><div class="line"></div><div class="line">        <span class="comment">// output</span></div><div class="line">        std::cout&lt;&lt;<span class="stringliteral">&quot;Minimum: &quot;</span>&lt;&lt; minimum_d &lt;&lt; std::endl;</div><div class="line"></div><div class="line">        <span class="comment">//time</span></div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;-----------------------------------------&quot;</span>&lt;&lt;std::endl;</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;| [Fit] GPU Time (ms) =&quot;</span>&lt;&lt; elapsed_d.count() &lt;&lt;std::endl;</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;-----------------------------------------&quot;</span>&lt;&lt;std::endl;</div><div class="line"></div><div class="line">        <span class="comment">//--------------------------------------------</span></div><div class="line">        <span class="comment">//splot 2 components</span></div><div class="line">        <span class="comment">//hold weights</span></div><div class="line">        <a class="code" href="namespacehydra.html#classhydra_1_1multiarray">hydra::multiarray&lt;double,2,  hydra::device::sys_t&gt;</a> sweigts_d(<a class="code" href="namespacehydra.html#a0cd814fb01cd9d4d7ca9fa8c289627d9">range</a>.size());</div><div class="line"></div><div class="line">        <span class="comment">//create splot</span></div><div class="line">        <span class="keyword">auto</span> splot  = <a name="a26"></a><a class="code" href="namespacehydra.html#af5314ace45b4baa7084a9addb625ca99">hydra::make_splot</a>(fcn.GetPDF() );</div><div class="line"></div><div class="line">        start_d = std::chrono::high_resolution_clock::now();</div><div class="line">        <span class="keyword">auto</span> covar = splot.Generate( <a class="code" href="namespacehydra.html#a0cd814fb01cd9d4d7ca9fa8c289627d9">range</a>.begin(), <a class="code" href="namespacehydra.html#a0cd814fb01cd9d4d7ca9fa8c289627d9">range</a>.end(), sweigts_d.begin());</div><div class="line">        end_d = std::chrono::high_resolution_clock::now();</div><div class="line">        elapsed_d = end_d - start_d;</div><div class="line"></div><div class="line">        <span class="comment">//time</span></div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;-----------------------------------------&quot;</span>&lt;&lt;std::endl;</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;| [sPlot] GPU Time (ms) =&quot;</span>&lt;&lt; elapsed_d.count() &lt;&lt;std::endl;</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;-----------------------------------------&quot;</span>&lt;&lt;std::endl;</div><div class="line"></div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Covariance matrix &quot;</span>&lt;&lt; std::endl &lt;&lt; covar&lt;&lt; std::endl &lt;&lt; std::endl;</div><div class="line">        std::cout&lt;&lt; std::endl &lt;&lt; <span class="stringliteral">&quot;sWeights:&quot;</span> &lt;&lt; std::endl;</div><div class="line">        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i&lt;10; i++)</div><div class="line">            std::cout&lt;&lt;  <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;] :&quot;</span> &lt;&lt;  sweigts_d[i] &lt;&lt; std::endl;</div><div class="line">        std::cout&lt;&lt; std::endl &lt;&lt; std::endl;</div><div class="line"></div><div class="line">        <span class="comment">//bring data to device</span></div><div class="line">        <a class="code" href="namespacehydra.html#classhydra_1_1multiarray">hydra::multiarray&lt; double,2, hydra::device::sys_t&gt;</a> data2_d(<a class="code" href="namespacehydra.html#a0cd814fb01cd9d4d7ca9fa8c289627d9">range</a>.size());</div><div class="line">        <a class="code" href="namespacehydra.html#a0b928198a46f83eb9d2793e8e079ba5a">hydra::copy</a>( <a class="code" href="namespacehydra.html#a0cd814fb01cd9d4d7ca9fa8c289627d9">range</a> ,  data2_d );</div><div class="line"></div><div class="line">        <span class="comment">//_______________________________</span></div><div class="line">        <span class="comment">//histograms</span></div><div class="line">        <span class="keywordtype">size_t</span> nbins = 100;</div><div class="line"></div><div class="line">        <a name="_a27"></a><a class="code" href="group__histogram.html#classhydra_1_1DenseHistogram">hydra::DenseHistogram&lt; double, 1, hydra::device::sys_t&gt;</a> Hist_Data(nbins, min, <a class="code" href="namespacehydra_1_1detail.html#a1152192bafa3c9d955919ee2fa88f8ef">max</a>);</div><div class="line"></div><div class="line">        start_d = std::chrono::high_resolution_clock::now();</div><div class="line">        Hist_Data.Fill(data2_d.begin(0), data2_d.end(0));</div><div class="line">        end_d = std::chrono::high_resolution_clock::now();</div><div class="line">        elapsed_d = end_d - start_d;</div><div class="line"></div><div class="line">        <span class="comment">//time</span></div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;-----------------------------------------&quot;</span>&lt;&lt;std::endl;</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;| [Histograming data] GPU Time (ms) =&quot;</span>&lt;&lt; elapsed_d.count() &lt;&lt;std::endl;</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;-----------------------------------------&quot;</span>&lt;&lt;std::endl;</div><div class="line"></div><div class="line">        <a class="code" href="group__histogram.html#classhydra_1_1DenseHistogram">hydra::DenseHistogram&lt;double, 1, hydra::device::sys_t&gt;</a> Hist_Control(nbins, min, <a class="code" href="namespacehydra_1_1detail.html#a1152192bafa3c9d955919ee2fa88f8ef">max</a>);</div><div class="line"></div><div class="line">        start_d = std::chrono::high_resolution_clock::now();</div><div class="line">        Hist_Control.Fill(data2_d.begin(1), data2_d.end(1));</div><div class="line">        end_d = std::chrono::high_resolution_clock::now();</div><div class="line">        elapsed_d = end_d - start_d;</div><div class="line"></div><div class="line">        <span class="comment">//time</span></div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;-----------------------------------------&quot;</span>&lt;&lt;std::endl;</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;| [Histograming control] GPU Time (ms) =&quot;</span>&lt;&lt; elapsed_d.count() &lt;&lt;std::endl;</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;-----------------------------------------&quot;</span>&lt;&lt;std::endl;</div><div class="line"></div><div class="line">        <a class="code" href="group__histogram.html#classhydra_1_1DenseHistogram">hydra::DenseHistogram&lt;double, 1, hydra::device::sys_t&gt;</a> Hist_Control_1(nbins, min, <a class="code" href="namespacehydra_1_1detail.html#a1152192bafa3c9d955919ee2fa88f8ef">max</a>);</div><div class="line"></div><div class="line">        start_d = std::chrono::high_resolution_clock::now();</div><div class="line">        Hist_Control_1.Fill(data2_d.begin(1), data2_d.end(1), sweigts_d.begin(0) );</div><div class="line">        end_d = std::chrono::high_resolution_clock::now();</div><div class="line">        elapsed_d = end_d - start_d;</div><div class="line"></div><div class="line">        <span class="comment">//time</span></div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;-----------------------------------------&quot;</span>&lt;&lt;std::endl;</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;| [Histograming control 1] GPU Time (ms) =&quot;</span>&lt;&lt; elapsed_d.count() &lt;&lt;std::endl;</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;-----------------------------------------&quot;</span>&lt;&lt;std::endl;</div><div class="line"></div><div class="line">        <a class="code" href="group__histogram.html#classhydra_1_1DenseHistogram">hydra::DenseHistogram&lt;double, 1, hydra::device::sys_t&gt;</a> Hist_Control_2(nbins, min, <a class="code" href="namespacehydra_1_1detail.html#a1152192bafa3c9d955919ee2fa88f8ef">max</a>);</div><div class="line"></div><div class="line">        start_d = std::chrono::high_resolution_clock::now();</div><div class="line">        Hist_Control_2.Fill(data2_d.begin(1), data2_d.end(1), sweigts_d.begin(1) );</div><div class="line">        end_d = std::chrono::high_resolution_clock::now();</div><div class="line">        elapsed_d = end_d - start_d;</div><div class="line"></div><div class="line">        <span class="comment">//time</span></div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;-----------------------------------------&quot;</span>&lt;&lt;std::endl;</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;| [Histograming control 2] GPU Time (ms) =&quot;</span>&lt;&lt; elapsed_d.count() &lt;&lt;std::endl;</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;-----------------------------------------&quot;</span>&lt;&lt;std::endl;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef _ROOT_AVAILABLE_</span></div><div class="line"></div><div class="line">        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> bin=0; bin &lt; nbins; bin++){</div><div class="line"></div><div class="line">            hist_data_dicriminating_d.SetBinContent(bin+1,  Hist_Data[bin] );</div><div class="line">            hist_data_control_d.SetBinContent(bin+1,  Hist_Control[bin] );</div><div class="line">            hist_control_1_d.SetBinContent(bin+1,  Hist_Control_1[bin] );</div><div class="line">            hist_control_2_d.SetBinContent(bin+1,  Hist_Control_2[bin] );</div><div class="line"></div><div class="line">        }</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">//draw fitted function</span></div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=1 ; i&lt;=100 ; i++) {</div><div class="line">            <span class="keywordtype">double</span> x = hist_fit_d.GetBinCenter(i);</div><div class="line">            hist_fit_d.SetBinContent(i, fcn.GetPDF()(x) );</div><div class="line">        }</div><div class="line">        hist_fit_d.Scale(hist_data_dicriminating_d.Integral()/hist_fit_d.Integral() );</div><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">#endif //_ROOT_AVAILABLE_</span></div><div class="line"></div><div class="line">    }<span class="comment">//device end</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef _ROOT_AVAILABLE_</span></div><div class="line"></div><div class="line">    TApplication *myapp=<span class="keyword">new</span> TApplication(<span class="stringliteral">&quot;myapp&quot;</span>,0,0);</div><div class="line"></div><div class="line">    <span class="comment">//draw histograms</span></div><div class="line">    TCanvas canvas_1_d(<span class="stringliteral">&quot;canvas_1_d&quot;</span> ,<span class="stringliteral">&quot;Distributions - Device&quot;</span>, 500, 500);</div><div class="line"></div><div class="line">    hist_data_dicriminating_d.Draw(<span class="stringliteral">&quot;hist&quot;</span>);</div><div class="line">    hist_fit_d.Draw(<span class="stringliteral">&quot;histsameC&quot;</span>);</div><div class="line">    hist_fit_d.SetLineColor(2);</div><div class="line"></div><div class="line">    TCanvas canvas_2_d(<span class="stringliteral">&quot;canvas_2_d&quot;</span> ,<span class="stringliteral">&quot;Distributions - Device&quot;</span>, 1000, 500);</div><div class="line">    canvas_2_d.Divide(2,1);</div><div class="line">    canvas_2_d.cd(1);</div><div class="line">    hist_control_1_d.Draw(<span class="stringliteral">&quot;hist&quot;</span>);</div><div class="line">    canvas_2_d.cd(2);</div><div class="line">    hist_control_2_d.Draw(<span class="stringliteral">&quot;hist&quot;</span>);</div><div class="line"></div><div class="line"></div><div class="line">    myapp-&gt;Run();</div><div class="line"></div><div class="line"><span class="preprocessor">#endif //_ROOT_AVAILABLE_</span></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* SPLOT_INL_ */</span><span class="preprocessor"></span></div></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Nov 3 2018 02:26:23 for Hydra by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
